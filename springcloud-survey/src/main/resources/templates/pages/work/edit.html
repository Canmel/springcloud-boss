<div id="subContainer" class="wrapper wrapper-content">
    <div class="ibox float-e-margins">
        <div class="ibox-content">
            <form class="form-horizontal m-t" id="signupForm">
                <div class="form-group">
                    <label class="col-sm-3 control-label">问卷名称<span class="text-danger">*</span>：</label>
                    <div class="col-sm-8">
                        <input id="pname" name="pname" class="form-control" type="text" v-model="work.pname"></input>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">访员名<span class="text-danger">*</span>：</label>
                    <div class="col-sm-8">
                        <input id="uname" name="uname" class="form-control" type="text" v-model="work.uname"></input>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">日期<span class="text-danger">*</span>：</label>
                    <div class="col-sm-8">
                        <input id="workDate" name="workDate" class="form-control" type="text" v-model="work.workDate"></input>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">接触量<span class="text-danger">*</span>：</label>
                    <div class="col-sm-8">
                        <input id="tryNum" name="tryNum" class="form-control" type="text" v-model="work.tryNum"></input>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">成功量<span class="text-danger">*</span>：</label>
                    <div class="col-sm-8">
                        <input id="successNum" name="successNum" class="form-control" type="text" v-model="work.successNum"></input>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">作废量<span class="text-danger">*</span>：</label>
                    <div class="col-sm-8">
                        <input id="invalidNum" name="invalidNum" class="form-control" type="text" v-model="work.invalidNum"></input>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">有效量<span class="text-danger">*</span>：</label>
                    <div class="col-sm-8">
                        <input id="validNum" name="validNum" class="form-control" type="text" v-model="work.validNum"></input>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">就餐时间<span class="text-danger">*</span>：</label>
                    <div class="col-sm-8">
                        <input id="eatTime" name="eatTime" class="form-control" type="text" v-model="work.eatTime"></input>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">工作时长<span class="text-danger">*</span>：</label>
                    <div class="col-sm-8">
                        <input id="workHours" name="workHours" class="form-control" type="text" v-model="work.workHours"></input>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">餐费<span class="text-danger">*</span>：</label>
                    <div class="col-sm-8">
                        <input id="meals" name="meals" class="form-control" type="text" v-model="work.meals"></input>
                    </div>
                </div>
                <div class="form-group">
                    <div class="col-sm-8 col-sm-offset-3">
                        <button type="button" class="btn btn-secondary" v-on:click="cancel()">取消</button>
                        <button type="button" class="btn btn-primary" v-on:click="save()">保存</button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>
<script src="/survey/js/validateIsMain.js"></script>
<script>
    new Vue({
        el: '#subContainer',
        data: {
            applicationContextRootPath: '/survey/',
            work:{
                pname:'',
                uname:'',
                workDate:'',
                tryNum:0,
                successNum:0,
                invalidNum:0,
                validNum:0,
                eatTime:0,
                workHours:0,
                meals:0,
            },
        },
        created: function () {
            this.loadEntity();
        },
        methods: {
            loadEntity() {
                let that = this;
                AJAX.GET('zsWork/' + sessionStorage.getItem('editParams'), {}, function (resp) {
                    that.work = {
                        id: resp.data.id,
                        pname: resp.data.pname,
                        uname: resp.data.uname,
                        workDate: resp.data.workDate,
                        tryNum: resp.data.tryNum,
                        successNum: resp.data.successNum,
                        invalidNum: resp.data.invalidNum,
                        validNum: resp.data.validNum,
                        eatTime: resp.data.eatTime,
                        workHours: resp.data.workHours,
                        meals: resp.data.meals,
                    };
                });
            },
            cancel: function () {
                this.backToMain();
            },
            save: function () {
                if(!$("#signupForm").valid()){
                    return false;
                }
                let that = this;
                AJAX.PUT('zsWork', JSON.stringify(this.work), function (resp) {
                    toastr.success(resp.msg);
                    that.backToMain();
                });
            },
            backToMain: function () {
                $.pjax({
                    url: mvm.applicationContextRootPath + 'pages/work/index.html',
                    container: '.page-container'
                });
            }
        }
    });

</script>