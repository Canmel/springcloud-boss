<div id="subContainer" class="wrapper wrapper-content" @click="enableEdit()">
    <section class="wrapper">
        <!-- page start-->
        <div class="row">
            <aside class="col-lg-3">
                <h4 class="drg-event-title"> 区县</h4>
                <div id='external-events'>
                    <div class='external-event label label-primary' draggable='true' @dragstart='drag($event)'>
                        黄岩区
                    </div>
                    <div class='external-event label label-success' draggable='true' @dragstart='drag($event)'>路桥区</div>
                    <div class='external-event label label-info'>My Event 3</div>
                    <div class='external-event label label-inverse'>My Event 4</div>
                    <div class='external-event label label-warning'>My Event 5</div>
                    <div class='external-event label label-danger'>My Event 6</div>
                    <div class='external-event label label-default'>My Event 7</div>
                    <div class='external-event label label-primary'>My Event 8</div>
                    <div class='external-event label label-info'>My Event 9</div>
                    <div class='external-event label label-success'>My Event 10</div>
                    <p class="border-top drp-rmv">
                        <input type='checkbox' id='drop-remove'/>
                        remove after drop
                    </p>
                </div>
            </aside>
            <aside class="col-lg-9">
                <section class="panel">
                    <table id="totalTable">
                        <tr v-for="(row, rowIndex) in rows">
                            <td v-for="(item, index) in row" @click.stop="toEdit(rowIndex, index)"
                                class="export-table-td" @dragover='allowDrop($event)' @drop='drop($event, item, row)'>
                                <input v-model="item.value" v-if="item.editable">
                                <span v-if="!item.editable">{{showValue(item, row)}}</span>
                            </td>
                            <td style="width: 50px; border: 1px dotted;" :rowspan="rows.length" v-if="rowIndex == 0"
                                class="row-add" @click="addColumn()">
                                <div>
                                    <i class="fa fa-plus" style="font-size: 40px;"></i>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td style="width: 50px; border: 1px dotted;" :colspan="rows[rows.length - 1].length"
                                class="add-btn" style="border: 1px dotted;">
                                <div @click="addRow()"><span class="fa fa-plus" style="font-size: 40px;"></span></div>
                            </td>
                        </tr>
                    </table>
                </section>
            </aside>
        </div>
        <!-- page end-->
    </section>
</div>
<style>
    .export-table-td {
        min-width: 50px;
        width: 100px;
        height: 40px;
        text-align: center;
        border: 1px solid;
    }

    #totalTable input {
        height: 40px;
        width: inherit;
    }

    .add-btn {
        text-align: center;
    }

    .add-btn :hover {
        background-color: burlywood;
        font-weight: 999;
    }

    .row-add {
        text-align: center;
    }

    .row-add :hover {
        background-color: burlywood;
        font-weight: 999;
    }

    .active-cell {
        border: 2px solid indianred;
    }
</style>
<script src="/survey/js/validateIsMain.js"></script>
<script>
    var vue = new Vue({
        el: '#subContainer',
        data: {
            applicationContextRootPath: '/survey/',
            rows: [],
            editModel: false
        },
        mounted() {
            console.log(this)
        },
        created: function () {
            let row = [];
            row.push({type: 'index', value: 1, editable: false});
            this.rows.push(row);
        },
        methods: {
            drag: function (event) {
                this.dom = event.currentTarget
            },
            drop: function (event, item, row) {
                event.preventDefault();
                $(".active-cell").removeClass("active-cell");
                item.value = this.dom.textContent.trim();
            },
            allowDrop: function (event) {
                event.preventDefault();
                $(".active-cell").removeClass("active-cell");
                if(event.target.tagName === 'TD') {
                    $(event.target).addClass("active-cell");
                }else {
                    $(event.target).parent().addClass("active-cell");
                }
            },
            showValue(item, row) {
                if (item.type == 'index') {
                    return this.rows.indexOf(row) + 1;
                }
                if (item.type == 'string') {
                    return item.value;
                }
                return item.value;
            },
            enableEdit() {
                this.editModel = false;
                for (let i = 0; i < this.rows.length; i++) {
                    for (let j = 0; j < this.rows[i].length; j++) {
                        if (this.rows[i][j].editable) {
                            this.rows[i][j].editable = this.editModel;
                        }
                    }
                }
            },
            toEdit(rowIndex, index) {
                this.editModel = true;
                for (let i = 0; i < this.rows.length; i++) {
                    for (let j = 0; j < this.rows[i].length; j++) {
                        if (i == rowIndex && j == index) {
                            this.rows[rowIndex][index]["editable"] = true;
                        } else {
                            this.rows[i][j].editable = false;
                        }
                    }
                }


            },
            addColumn() {
                for (let i = 0; i < this.rows.length; i++) {
                    console.log(1)
                    this.rows[i].push({type: 'string', value: '新字段', editable: false});
                }
            },
            addRow() {
                let row = JSON.parse(JSON.stringify(this.rows[this.rows.length - 1]));
                this.rows.push(row);
            },
        }
    });
</script>
