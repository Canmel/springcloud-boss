<style>
    body{
        padding:0;
        margin:0;
    }
    *{
        text-decoration: none;
    }
    .my_box{
        width:75px;
        height:75px;
        overflow: hidden;
        border-radius:15px;
        border:1px solid #ccc;
        left:0;
        right:0;
        top:0;
        bottom:0;
        margin:auto;
        transition: .6s;
        cursor: pointer;
    }
    .my_box:hover{
        animation:my_box 0.5s forwards;
        transition: .5s;
    }
    @keyframes my_box{
        form{
            transform: rotate(0deg);
        }
        to{
            transform: rotate(360deg);
        }
    }
    .my_box img{
        width:100%;
    }
    .xiantiao{
        display: block;
        width:86%;
        height:1px;
        border-bottom: 1px solid #ccc;
        margin:0 auto;
    }

    .pic_box{
        width:609px;
        min-height:673px;
        height:auto;
        border-radius:8px;
        background: #fff;
        border:1px solid #ccc;
        position: fixed;
        top:-1000px;
        left:0;
        right:0;
        margin:0 auto;
    }
    .header{
        height:45px;
        text-align: center;
    }
    .close{
        color:#000;
        font-size: 21px;
        line-height: 1;
        text-shadow: 0 1px 0 #fff;
        opacity: .2;
        position:absolute;
        right:8px;
        top:2px;
        cursor: pointer;
    }
    .pic_box ul{
        padding: 0;
        margin:0;
        width:96%;
        height:511px;
        margin:10px auto;
    }
    .pic_box ul li{
        display: block;
        list-style: none;
        width:61px;
        height:61px;
        float: left;
        border-radius: 15%;
        border:1px solid #ccc;
        margin:5px 5px;
        transition: .6s;
        cursor: pointer;
        overflow: hidden;
    }
    .pic_box ul li:hover{
        transform: scale(1.15);
        transition: .5s;
    }
    .pic_box ul li img{
        width:100%;
    }
    .bt_box{
        width: 100%;
        text-align: center;
        font-size: 14px;
        margin-top: 30px;
    }
    .bt_box .gb{
        display:inline-block;
        width:120px;
        height:35px;
        border-radius: 8px;
        background:#f3f3f3;
        color:#444;
        line-height: 35px;
    }
    .bt_box .queren{
        display: inline-block;
        width:120px;
        height:35px;
        border-radius: 8px;
        background:#4B8BF5;
        color:#fff;
        line-height: 35px;
    }
</style>
<div id="subContainer" class="wrapper wrapper-content">
    <div class="row animated fadeInRight">
        <div class="col-sm-4">
            <div class="ibox float-e-margins">
                <div class="ibox-title">
                    <h5>个人资料</h5>
                </div>
                <div>
                    <div class="ibox-content profile-content">
                        <a class="t"></a>
                        <div class="my_box">
                            <form id="uploadForm">
                                <input class="jide" name="imgsrc" type="hidden" value="" />
                                <img :src="profile.avatar" class="my_pic"/>
                            </form>
                        </div>
                        <div class="pic_box" id="pic_box" style="z-index: 999">
                            <div class="header">
                                <p>设置头像</p>
                                <span class="close">x</span>
                            </div>
                            <span class="xiantiao"></span>
                            <ul>
                                <li v-for="index in 47"><img :src="'/survey/img/avatar/' + (index + 1) + '.png'"/></li>
                            </ul>
                            <div class="bt_box">
                                <a class="gb" href="javascript:">关闭</a>
                                <a class="queren" href="javascript:">保存头像</a>
                            </div>
                        </div>
                        <a class="btn btn-success" v-if="resultIn">完善信息</a>
                        <div class="row padding-line">
                            <div class="col col-sm-4 text-right">用户姓名：</div>
                            <div class="col col-sm-8"><strong>{{profile.username}}</strong></div>
                        </div>
                        <div class="row padding-line">
                            <div class="col col-sm-4 text-right">邮箱账号：</div>
                            <div class="col col-sm-8"><strong>{{profile.email}}</strong></div>
                        </div>
                        <div class="row padding-line">
                            <div class="col col-sm-4 text-right">用户昵称：</div>
                            <div class="col col-sm-8">
                                <strong>{{profile.nickname}}</strong>
                            </div>
                        </div>
                        <div class="row padding-line">
                            <div class="col col-sm-4 text-right">身份证号：</div>
                            <div class="col col-sm-8"><strong>{{profile.idNum}}</strong></div>
                        </div>
                        <div class="row padding-line">
                            <div class="col col-sm-4 text-right">坐标位置：</div>
                            <div class="col col-sm-8"><p><i class="fa fa-map-marker"></i> {{profile.address}}</p></div>
                        </div>
                        <div class="row padding-line">
                            <div class="col col-sm-4 text-right">用户工号：</div>
                            <div class="col col-sm-8"><strong>{{user.workNum}}</strong></div>
                        </div>
                        <div class="row m-t-lg">
                            <div class="col-sm-4">
                                <span class="bar" style="display: none;">5,3,9,6,5,9,7,3,5,2</span><svg class="peity" height="16" width="32"><rect fill="#1ab394" x="0" y="7.111111111111111" width="2.3" height="8.88888888888889"></rect><rect fill="#d7d7d7" x="3.3" y="10.666666666666668" width="2.3" height="5.333333333333333"></rect><rect fill="#1ab394" x="6.6" y="0" width="2.3" height="16"></rect><rect fill="#d7d7d7" x="9.899999999999999" y="5.333333333333334" width="2.3" height="10.666666666666666"></rect><rect fill="#1ab394" x="13.2" y="7.111111111111111" width="2.3" height="8.88888888888889"></rect><rect fill="#d7d7d7" x="16.5" y="0" width="2.3" height="16"></rect><rect fill="#1ab394" x="19.799999999999997" y="3.555555555555557" width="2.3" height="12.444444444444443"></rect><rect fill="#d7d7d7" x="23.099999999999998" y="10.666666666666668" width="2.3" height="5.333333333333333"></rect><rect fill="#1ab394" x="26.4" y="7.111111111111111" width="2.3" height="8.88888888888889"></rect><rect fill="#d7d7d7" x="29.7" y="12.444444444444445" width="2.3" height="3.5555555555555554"></rect></svg>
                               <a href="#" v-on:click="showDelivery()">
                                <h5 class="text-info"><strong>{{countDelivery}}</strong> 考试通过</h5>
                               </a>
                            </div>

                            <!--<a href="#" onclick="alert('我是问卷调查')">-->
                            <div class="col-sm-4">
                                <span class="line" style="display: none;">5,3,9,6,5,9,7,3,5,2</span><svg class="peity" height="16" width="32"><polygon fill="#1ab394" points="0 15 0 7.166666666666666 3.5555555555555554 10.5 7.111111111111111 0.5 10.666666666666666 5.5 14.222222222222221 7.166666666666666 17.77777777777778 0.5 21.333333333333332 3.833333333333332 24.888888888888886 10.5 28.444444444444443 7.166666666666666 32 12.166666666666666 32 15"></polygon><polyline fill="transparent" points="0 7.166666666666666 3.5555555555555554 10.5 7.111111111111111 0.5 10.666666666666666 5.5 14.222222222222221 7.166666666666666 17.77777777777778 0.5 21.333333333333332 3.833333333333332 24.888888888888886 10.5 28.444444444444443 7.166666666666666 32 12.166666666666666" stroke="#169c81" stroke-width="1" stroke-linecap="square"></polyline></svg>
                                <a href="#" v-on:click="showSign()">
                                <h5 class="text-info"><strong>{{countSign}}</strong> 调查问卷</h5>
                                </a>
                            </div>
                        </div>
                        <div class="user-button">
                            <div class="row">
                                <div class="col-sm-6">
                                    <button type="button" class="btn btn-primary btn-sm btn-block" v-if="resultIn"><i class="fa fa-envelope"></i> 发送消息</button>
                                </div>
                                <div class="col-sm-6">
                                    <button type="button" class="btn btn-default btn-sm btn-block" v-if="resultIn" @click="toWorkList()"><i class="fa fa-coffee"></i> 工作记录</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

<!--            <div class="ibox float-e-margins">-->
<!--                <div class="" id="ibox-content">-->
<!--                    <div id="vertical-timeline" class="vertical-container light-timeline">-->
<!--                        <div class="vertical-timeline-block" v-for="(item, index) in userActives">-->
<!--                            <div class="vertical-timeline-icon navy-bg">-->
<!--                                <i class="fa fa-briefcase"></i>-->
<!--                            </div>-->

<!--                            <div class="vertical-timeline-content">-->
<!--                                <h2>会议</h2>-->
<!--                                <p>上一年的销售业绩发布会。总结产品营销和销售趋势及销售的现状。-->
<!--                                </p>-->
<!--                                <a href="#" class="btn btn-sm btn-primary" v-if="resultIn"> 更多信息</a>-->
<!--                                <span class="vertical-date">-->
<!--                                    今天 <br>-->
<!--                                    <small>2月3日</small>-->
<!--                                </span>-->
<!--                            </div>-->
<!--                        </div>-->
<!--                    </div>-->
<!--                </div>-->
<!--            </div>-->
        </div>

        <div class="col-sm-8">
            <div class="ibox float-e-margins">
                <div class="ibox-title">
                    <h5>最新动态</h5>
                    <div class="ibox-tools">
                        <a class="collapse-link">
                            <i class="fa fa-chevron-up"></i>
                        </a>
                        <a class="dropdown-toggle" data-toggle="dropdown" href="profile.html#">
                            <i class="fa fa-wrench"></i>
                        </a>
                        <ul class="dropdown-menu dropdown-user">
                            <li><a href="profile.html#">选项1</a>
                            </li>
                            <li><a href="profile.html#">选项2</a>
                            </li>
                        </ul>
                    </div>
                </div>
                <div class="ibox-content">
                    <div>
                        <div class="feed-activity-list" v-for="(item, index) in userActives">
                            <div class="feed-element">
                                <a href="profile.html#" class="pull-left">
                                    <span class="fa fa-user"></span>
                                </a>
                                <div class="media-body ">
                                    <small class="pull-right text-navy">{{item.createdAt | toNow}}</small>
                                    <strong>{{item.username}}</strong> <strong style="color: #0d8ddb; cursor: pointer;" @click="showWorkDetails(item)">{{item.active }}</strong>.
                                    <br>
                                    <small class="text-muted">{{item.createdAt | toNow}} </small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal fade " id="countDelivery" tabindex="-1" role="dialog" aria-labelledby="myModalLabel1" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content " style="width: 800px">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                        <h4 class="modal-title" id="myModalLabel1">考试通过详情</h4>
                    </div>
                    <div class="modal-body">
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                <tr>
                                    <th>姓名</th>
                                    <th>智慧资格名称</th>
                                    <th>申请时间</th>
                                    <th>状态(是否通过)</th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr v-for="item in itemsDelivery">
                                    <td v-if="item.creator"><span>{{item.creator.username}}</span></td>
                                    <td v-if="item.exam"><span>{{item.exam.name}}</span></td>
                                    <td> {{item.createdAt}}</td>
                                    <td v-if="item.ach && item.ach.value == 1"><span class="badge badge-info">{{item.ach.name}}</span></td>
                                    <td v-if="item.ach && item.ach.value == 0"><span class="badge badge-danger">{{item.ach.name}}</span></td>
                                    <td v-if="item.ach && item.ach.value == 2"><span class="badge">{{item.ach.name}}</span></td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div class="modal-footer">
                        <pageination :total="pageInfoDelivery.total" :size="pageInfoDelivery.size" :page="pageInfoDelivery.pageNum"
                                     :changge="pageFnDelivery"></pageination>
                    </div>
                </div><!-- /.modal-content -->
            </div><!-- /.modal -->
        </div>
        <div class="modal fade" id="countSign" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
            <div class="modal-dialog" style="width: 80%;">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                        <h4 class="modal-title" id="myModalLabel">调查问卷详情</h4>
                    </div>
                    <div class="modal-body">
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                <tr>
                                    <th>姓名</th>
                                    <th>问卷名称</th>
                                    <th>申请日期</th>
                                    <th>状态(是否通过)</th>
                                    <th>接触量</th>
                                    <th>成功量</th>
                                    <th>无效量</th>
                                    <th>作废量</th>
                                    <th>总通话时长</th>
                                    </tr>
                                </thead>
                                <tbody>
                                <tr v-for="item in itemsSign">
                                    <td v-if="item.creator"><span>{{item.creator.username}}</span></td>
                                    <td v-if="item.survey"><span>{{item.survey.name}}</span></td>
                                    <td><span>{{item.createdAt}}</span></td>
                                    <td v-if="item.result.value == 1"><span class="badge badge-info">{{item.result.name}}</span></td>
                                    <td v-if="item.result.value == 0"><span class="badge badge-danger">{{item.result.name}}</span></td>
                                    <td v-if="item.result.value == 2"><span class="badge">{{item.result.name}}</span></td>
                                    <td>未知</td>
                                    <td>{{item.successNum}}</td>
                                    <td>{{item.invalidNum}}</td>
                                    <td>{{item.invalidNum}}</td>
                                    <td>{{item.callLastsTime | sToTime}}</td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div class="modal-footer">
                        <pageination :total="pageInfoSign.total" :size="pageInfoSign.size" :page="pageInfoSign.pageNum"
                                     :changge="pageFnSign"></pageination>
                    </div>
                </div><!-- /.modal-content -->
            </div><!-- /.modal -->
        </div>

    </div>
</div>
<script src="/survey/js/validateIsMain.js"></script>
<script>
    var vue = new Vue({
        el: '#subContainer',
        data: {
            applicationContextRootPath: '/survey/',
            profile: {},
            userActives: [],
            master: [],//接受权限数组
            result: false,
            resultIn: false,//表示访客权限
            resultDev: false,//表示操作人员权限
            user: {username:'',phone:'',userid:'',password:''},//存储username查取其参与考试
            countSign: 0,
            countDelivery: 0,
            itemsSign:{},
            itemsDelivery:{},
            pageInfoDelivery: {
                creatorId: [0],
                pageNum: 1,
                total: 0,//总页数
                size: 10,//每页显示条目个数不传默认10
            },
            pageInfoSign: {
                creatorId: [0],
                pageNum: 1,
                total: 0,//总页数
                size: 10,//每页显示条目个数不传默认10
            }
        },
        created: function () {
            this.loadMe();
            this.loadUserActive();
            this.loginMaster();
            var userJsonStr = sessionStorage.getItem('user');
            this.user = JSON.parse(userJsonStr);
            this.loadCountSign();
            this.loadUserWorkNum();
        },
        methods: {
            showWorkDetails(item) {
                console.log(item);
            },
            loadUserWorkNum(){
                this.user.workNum = (this.user.userid + 1000) + '';
            },
            toWorkList() {
                toPage('pages/work/list.html');
            },
            loginMaster(){
                var that = this;
                this.master = sessionStorage.getItem('master');
                var masterJ = JSON.parse(this.master);
                masterJ.forEach(e => {
                    var authority = e.authority;
                    if(authority ==='ROLE_ADMIN'){
                        that.result = true;
                        that.resultDev = true;
                        that.resultIn =true;
                    }
                    if(authority ==='ROLE_DEVOPS'){
                        that.resultDev = true;
                        that.resultIn =true;
                    }
                    if(authority === 'ROLE_INTERVIEWER'){that.resultIn =true;}
                })
            },
            loadUserActive() {
                var that = this;
                AJAX.GET("zsSign/user", {}, function (resp) {
                    that.userActives = resp.data;
                });
            },
            loadMe(){
                var that = this;
                AJAX.GET('profile', {}, function (resp) {
                    that.profile = resp.data;
                });
            },
            loadCountSign(){
                var that = this;
                AJAX.GET('zsSign/signcount',that.user,function(resp){
                    that.countSign = resp.data.countSign;
                    that.countDelivery = resp.data.countDelivery;
                })
            },
            pageFnDelivery: function (val) {
                this.pageInfoDelivery.pageNum = val;
                this.pagequeryDelivery();
            },
            pageFnSign: function (val) {
                this.pageInfoSign.pageNum = val;
                this.pagequerySign();
            },
            pagequeryDelivery: function () {
                    this.pageInfoDelivery.creatorId = this.user.userid;
                    var that = this;
                    AJAX.GET('zsDelivery',this.pageInfoDelivery, function (resp) {
                        that.itemsDelivery = resp.data.list;
                        that.pageInfoDelivery.pageNum = resp.data.pageNum;
                        that.pageInfoDelivery.total = resp.data.total;
                    })
            },
            pagequerySign: function () {
                    this.pageInfoSign.creatorId = this.user.userid;
                    var that = this;
                    AJAX.GET('zsSign',this.pageInfoSign, function (resp) {
                        that.itemsSign = resp.data.list;
                        that.pageInfoSign.pageNum = resp.data.pageNum;
                        that.pageInfoSign.total = resp.data.total;
                    })
            },
            showDelivery(){
                $("#countDelivery").modal('show');
                $(".modal-backdrop").attr("class","");
            },
            showSign(){
                $("#countSign").modal('show');
                $(".modal-backdrop").attr("class","");
            }
        }
    })
</script>

<script type="text/javascript">
    $(".close,.gb").click(function(){
        $(".pic_box").animate({
            'top':'-1000px'
        },500);
    }),
        $(".my_box").click(function(){
            $(".pic_box").animate({
                'top':'15px',
            },300);
        }),
        $(".queren").click(function(){
            var src = $(".jide").val();
            //$.ajax与index.php交互,在php中判断文件,保存至数据库即可

            if(src != ""){
                console.log(src);
                AJAX.PUT('/system/sysUser',JSON.stringify({uid: vue.profile['uid'], avatar: src}), function (resp) {
                    console.log(resp);
                    toastr.success(resp.msg);
                    $(".my_pic").attr('src',src);
                    $(".pic_box").animate({
                        'top':'-1000px'
                    },500);
                });
            }else{
                return false;
            }

        //     /**
        //      * 后台我是用Thinkphp框架写的代码如下
        //      $show=M('user')->getByusername($_SESSION['_username']);
        //      if(!empty($_POST['imgsrc'])){
		// 	$_POST['id']=$show['id'];
		// 	$x=$info->create();
		// 	$res=$info->save();
		// 	if($res){
		// 		echo json_encode($_POST['imgsrc']);
		// 	}
		// }
        //      */
        //
        //
        //     //效果展示,在服务器中把这一段删除,用上面那一段
        //     if(src != ""){
        //         $(".my_pic").attr('src',src);
        //         $(".pic_box").animate({
        //             'top':'-1000px'
        //         },500);
        //     }else{
        //         return false;
        //     }

        });
    var $box = document.getElementById('pic_box');
    var $li = $box.getElementsByTagName('li');
    var index = 0;
    for(var i=0;i<$li.length;i++){
        $li[i].index=i;
        $li[i].onclick=function(){
            $li[index].style.borderRadius="15%";
            this.style.borderRadius="50%";
            index = this.index;
        }
    }
    $(".pic_box li img").click(function(){
        var src=$(this).attr("src");
        $(".jide").val(src);
    })
</script>