<div id="subContainer" class="wrapper wrapper-content">
    <div class="ibox float-e-margins">
        <div class="ibox-content">
            <form class="form-horizontal m-t" id="signupForm">
                <div class="form-group">
                    <label class="col-sm-3 control-label">请输入旧密码：</label>
                    <div class="col-sm-8">
                        <input id="oldPwd" name="oldPwd" class="form-control" type="text" v-model="user.oldPwd">
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">请输入新密码：</label>
                    <div class="col-sm-8">
                        <input id="newPwd1" name="newPwd1" class="form-control" type="text" v-model="user.newPwd1">
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">请重复新密码：</label>
                    <div class="col-sm-8">
                        <input id="newPwd2" name="newPwd2" class="form-control" type="text" v-model="user.newPwd2">
                    </div>
                </div>
                <div class="form-group">
                    <div class="col-sm-8 col-sm-offset-3">
                        <button type="button" class="btn btn-secondary" v-on:click="cancel()">取消</button>
                        <button type="button" class="btn btn-primary" v-on:click="save()">确认</button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>
<script src="/survey/js/validateIsMain.js"></script>
<script>
    new Vue({
        el: '#subContainer',
        data: {
            applicationContextRootPath: '/survey/',
            user:{
                userId:'',
                oldPwd:'',
                newPwd1:'',
                newPwd2:'',
            },
            profile:{}
        },
        created: function () {
            this.loadMe();
        },
        methods: {
            loadMe(){
                var that = this;
                AJAX.GET('profile', {}, function (resp) {
                    that.profile = resp.data;
                });
                console(profile);
                that.user.userId=profile.uid;
            },
            cancel: function () {
                this.backToMain();
            },
            save: function () {
                let that = this;
                console.log(that.user);
                confirm("您确定要修改密码吗?修改后需重新登录！", "", function (isConfirm) {
                    if (isConfirm) {
                        if(!$("#signupForm").valid()){
                            return false;
                        }

                        AJAX.PUT('/system/sysUser', JSON.stringify(this.user), function (resp) {
                            toastr.success(resp.msg);
                            that.backToMain();
                        });
                    } else {
                        //after click the cancel
                    }
                }, {confirmButtonText: '确认', cancelButtonText: '取消', width: 400});

            },
            backToMain: function () {
                $.pjax({
                    url: mvm.applicationContextRootPath + 'pages/home.html',
                    container: '.page-container'
                });
            }
        }
    });

</script>