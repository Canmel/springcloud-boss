<div id="subContainer">
    <section class="py-5">
        <div class="card">
            <div class="card-header">
                <div class="row">
                    <div class="col-sm-6" style="">
                        <h6 class="text-uppercase mb-0">考勤记录</h6>
                    </div>
                </div>
            </div>
            <div class="card-body">
                <table class="table table-striped card-text">
                    <thead>
                    <tr>
                        <th>序号</th>
                        <th>打卡人员</th>
                        <th>类型</th>
                        <th>判定</th>
                        <th>打卡时间</th>
                        <th>操作</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr v-for="(item, index) in items">
                        <th scope="row">{{(pageInfo.pageNum - 1) * 10 + index + 1}}</th>
                        <td>{{item.user ? item.user.username : ''}}</td>
                        <td>{{item.type === 0 ? '签到' : '签退'}}</td>
                        <td v-if="item.determine === 0"><span class="badge badge-danger">迟到</span></td>
                        <td v-if="item.determine === 1"><span class="badge badge-green">正常</span></td>
                        <td v-if="item.determine === 2"><span class="badge badge-danger">早退</span></td>

                        <td>{{item.createdAt | formatDate}}</td>
                        <td><a class="edit_btn_a" v-on:click="edit(item)"><i>修改</i></a> |
                            <a class="delete_btn_a" v-on:click="deleteItem(item)"><i>删除</i></a></td>
                    </tr>
                    </tbody>
                </table>
                <pageination :total="pageInfo.total" :size="pageInfo.size" :page="pageInfo.pageNum"
                             :changge="pageFn"></pageination>
            </div>
        </div>
    </section>

</div>

<script src="/attendance/js/validateIsMain.js"></script>
<script>
    var vue = new Vue({
        el: '#subContainer',
        data: {
            applicationContextRootPath: '/attendance/',
            pageInfo: {
                pageNum: 1,
                total: 0,//总页数
                size: 10,//每页显示条目个数不传默认10
            },
            items: [{}]
        },
        created: function () {
            this.pagequery();
        },
        methods: {
            pagequery: function () {
                var that = this;
                AJAX.GET('/attendance/signRecords', this.pageInfo, function (resp) {
                    that.items = resp.data.list;
                    that.pageInfo.pageNum = resp.data.pageNum;
                    that.pageInfo.total = resp.data.total;
                })
            },
            pageFn: function (val) {
                this.pageInfo.pageNum = val;
                this.pagequery();
            },
            edit: function (item) {
                sessionStorage.setItem('editParams', item.id);
                $.pjax({
                    url: mvm.applicationContextRootPath + 'pages/args/args_edit.html',
                    container: '.page-container'
                });
            },
            deleteItem: function (item) {
                var that = this;
                confirm("您确定要删除这条数据吗?", "", function (isConfirm) {
                    if (isConfirm) {
                        AJAX.DELETE('/attendance/args', item, function (resp) {
                            $.Toast("成功", resp.msg, "success", {
                                stack: true,
                                fullscreen: false,
                                sticky: false,
                                rtl: false
                            });
                            that.pagequery();
                        } )

                    } else {
                        //after click the cancel
                    }
                }, {confirmButtonText: '确认', cancelButtonText: '取消', width: 400});

            }
        },
        filters: {
            determineFormate: function (val) {
                if(val === 0){
                    return '';
                }
                if(val === 1){
                    return '<span class="btn btn-success">正常</span>';
                }
                if(val === 2){
                    return '<span class="btn btn-danger">早退</span>';
                }
            }
        }
    });
</script>
