<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>预约报名</title>
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=0,viewport-fit=cover">
    <link rel="stylesheet" href="/viewer/wx/css/weui.css">
    <link rel="stylesheet" href="/viewer/wx/css/example.css"/>
    <link rel="stylesheet" href="/viewer/wx/css/jquery-weui.css">
    <link rel="stylesheet" href="/viewer/wx/css/demos.css">
</head>
<body>
<div class="container" id="container">
    <div class="page form_page js_show" id="wrapper">
        <div class="weui-form">
            <div class="weui-form__text-area">
                <h2 class="weui-form__title">兼职预约报名</h2>
            </div>
            <div class="weui-form__control-area">
                <div class="weui_cells weui_cells_form">
                    <form id="userinfoForm">
                        <div class="weui-cells__title">基本信息</div>
                        <div class="weui-cells weui-cells_form">
                            <div class="weui-cell">
                                <div class="weui-cell__hd"><label class="weui-label">姓名</label></div>
                                <div class="weui-cell__bd">
                                    <input class="weui-input" type="text" placeholder="请输入你的真实姓名"
                                           v-model="userinfo.username" minlength="2" required>
                                </div>
                            </div>
                            <div class="weui-cell weui-cell_select weui-cell_select-after">
                                <div class="weui-cell__hd">
                                    <label class="weui-label">性别</label>
                                </div>
                                <div class="weui-cell__bd">
                                    <select class="weui-select" v-model="userinfo.sex">
                                        <option value="0">女</option>
                                        <option value="1">男</option>
                                    </select>
                                </div>
                            </div>
                            <div class="weui-cell">
                                <div class="weui-cell__hd">
                                    <label class="weui-label">邮箱</label>
                                </div>
                                <div class="weui-cell__bd">
                                    <input class="weui-input" placeholder="请输入你的邮箱" v-model="userinfo.email"
                                           v-bind:disabled="isEdit"
                                           type="email" name="email" required/>
                                </div>
                            </div>
                            <div class="weui-cell">
                                <div class="weui-cell__hd"><label class="weui-label">身份证号</label></div>
                                <div class="weui-cell__bd">
                                    <input class="weui-input" type="text" name="idNum" required v-bind:disabled="isEdit"
                                           pattern="/^[1-9]\d{7}((0\d)|(1[0-2]))(([0|1|2]\d)|3[0-1])\d{3}$|^[1-9]\d{5}[1-9]\d{3}((0\d)|(1[0-2]))(([0|1|2]\d)|3[0-1])\d{3}([0-9]|X)$/"
                                           placeholder="请输入身份证号" v-model="userinfo.idNum">
                                </div>
                            </div>
                            <div class="weui-cell">
                                <div class="weui-cell__hd"><label class="weui-label">学校</label></div>
                                <div class="weui-cell__bd">
                                    <input class="weui-input" type="text" placeholder="请输入你的学校"
                                           v-model="userinfo.school" name="school" required>
                                </div>
                            </div>
                            <div class="weui-cell">
                                <div class="weui-cell__hd">
                                    <label class="weui-label">手机号</label>
                                </div>
                                <div class="weui-cell__bd">
                                    <input class="weui-input" type="number" placeholder="请输入手机号"
                                           v-model="userinfo.phone" name="phone" required>
                                </div>
                            </div>

                            <div class="weui-cell weui-cell_select weui-cell_select-after">
                                <div class="weui-cell__hd">
                                    <label class="weui-label">性别</label>
                                </div>
                                <div class="weui-cell__bd">
                                    <select class="weui-select" v-model="userinfo.sex">
                                        <option value="0">女</option>
                                        <option value="1">男</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="weui-cells__title">预约信息</div>
                        <div class="weui-cells weui-cells_form">
                            <div class="weui-cell weui-cell_select weui-cell_select-after">
                                <div class="weui-cell__hd">
                                    <label class="weui-label">兼职地点</label>
                                </div>
                                <div class="weui-cell__bd">
                                    <select class="weui-select" v-model="userinfo.address">
                                        <option value="宁波民调">宁波民调</option>
                                        <option value="金华民调">金华民调</option>
                                        <option value="天湖大厦">天湖大厦</option>
                                        <option value="台州民调">台州民调</option>
                                        <option value="智慧调查">智慧调查</option>
                                    </select>
                                </div>
                            </div>
                            <div class="weui-cell">
                                <div class="weui-cell__hd">
                                    <label class="weui_label" for="date">兼职日期</label>
                                </div>
                                <div class="weui-cell__bd">
                                    <input class="weui-input" id="date" type="text"
                                           v-model="userinfo.workDate" name="workDate" required>
                                </div>
                            </div>
                            <div class="weui-cell weui-cell_select weui-cell_select-after">
                                <div class="weui-cell__hd">
                                    <label class="weui-label">报名班次</label>
                                </div>
                                <div class="weui-cell__bd">
                                    <select class="weui-select" v-model="userinfo.address">
                                        <option value="09：00—20：30">09：00—20：30</option>
                                        <option value="09：00—17：30">09：00—17：30</option>
                                        <option value="13：00—20：30">13：00—20：30</option>
                                        <option value="09：00—12：00">09：00—12：00</option>
                                        <option value="13：00—17：30">13：00—17：30</option>
                                        <option value="13：00—17：30">18：00—20：30</option>
                                    </select>
                                </div>
                            </div>

                            <div class="weui-cell">
                                <div class="weui-cell__hd">
                                    <label class="weui_label" for="date">绿码</label>
                                </div>
                                <div class="weui_uploader_bd" style="display: flex;">
                                    <ul class="weui_uploader_files">
                                        <li class="weui_uploader_file"
                                            style="background-image:url(http://shp.qpic.cn/weixinsrc_pic/pScBR7sbqjOBJomcuvVJ6iacVrbMJaoJZkFUIq4nzQZUIqzTKziam7ibg/)"></li>
                                    </ul>
                                    <div class="weui_uploader_input_wrp">
                                        <input class="weui_uploader_input" type="file"
                                               accept="image/jpg,image/jpeg,image/png,image/gif" multiple="">
                                    </div>
                                </div>
                            </div>
                            <div class="weui-cell">
                                <div class="weui-cell__hd">
                                    <label class="weui_label" for="date">防疫行程卡</label>
                                </div>
                                <div class="weui_uploader_bd" style="display: flex;">
                                    <ul class="weui_uploader_files">
                                        <li class="weui_uploader_file"
                                            style="background-image:url(http://shp.qpic.cn/weixinsrc_pic/pScBR7sbqjOBJomcuvVJ6iacVrbMJaoJZkFUIq4nzQZUIqzTKziam7ibg/)"></li>
                                    </ul>
                                    <div class="weui_uploader_input_wrp">
                                        <input class="weui_uploader_input" type="file"
                                               accept="image/jpg,image/jpeg,image/png,image/gif" multiple="">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
            <div class="weui-form__opr-area">
                <a class="weui-btn weui-btn_primary" href="javascript:" id="showTooltips" v-on:click="submit">确定</a>
            </div>
            <div class="weui-form__extra-area">
                <div class="weui-footer">
                    <p class="weui-footer__links">
                        <a href="javascript:" class="weui-footer__link">赛炜调查提供技术支持</a>
                    </p>
                    <p class="weui-footer__text">Copyright © 2008-2019 diaocha.cn</p>
                </div>
            </div>
        </div>

        <div class="page__ft j_bottom">
            <!--             准备来一个logo-->
            <!--            <a href="javascript:home()"><img src="https://weui.io/images/icon_footer_link.png"></a>-->
        </div>
    </div>
</div>
<script src="/viewer/wx/js/fastclick.js"></script>
<script src="/viewer/wx/js/jquery-2.1.4.js"></script>

<script src="/viewer/wx/js/jquery.validate.min.js"></script>
<script src="/viewer/wx/js/jquery.validate.zh.js"></script>
<script src="/viewer/wx/js/vue.js"></script>

<script src="/viewer/wx/js/jquery-weui.js"></script>
<script src="/viewer/wx/js/ajax-util.js"></script>
</body>
<script>
    $(function () {
        $("#date").calendar({
            value: [new Date()],
            minDate: new Date()
        });
    })
</script>
<script type="application/javascript">
    new Vue(
        {
            el: '#wrapper',
            data: {
                userinfo: {
                    id: '',
                    openid: '',
                    username: '',
                    idNum: '',
                    school: '',
                    phone: '',
                    sex: '0',
                    email: '',
                    validCode: ''
                },
                submitActive: true,
                countNum: 60,
                counter: null,
                isEdit: false
            },
            created: function () {
                this.initUserInfo();
            },
            methods: {
                clearCount() {
                    window.clearInterval(this.counter);
                },
                sendValidateCode() {
                    if (!this.submitActive) {
                        return;
                    }
                    let that = this;
                    if (this.userinfo.phone) {
                        this.counter = window.setInterval(function () {
                            that.countNum--;
                            if (that.countNum === 0) {
                                that.countNum = 60;
                                that.clearCount();
                                that.submitActive = true;
                            }
                        }, 1000);
                        this.submitActive = false;
                        $.ajax({
                            url: '/viewer/valid/send?phone=' + this.userinfo.phone,
                            type: 'get',
                            success: function (resp) {
                                if (resp.code === 200) {
                                    $.toast(resp.msg, function () {
                                    });
                                } else {
                                    $.toast(resp.msg, "cancel", function () {
                                    });
                                }
                            }
                        });
                    } else {
                        $.toast("请输入正确的手机号", "cancel", function (toast) {
                        });
                    }
                },
                submit() {
                    return ;
                    let that = this;
                    if (!that.userinfo.openid) {
                        return $.toast("从微信获取信息失败，请稍后重试，或重新关注公众号", function () {
                        });
                    }
                    if ($("#userinfoForm").valid()) {
                        if (this.userinfo.id) {
                            AJAX.PUT("wxUser", this.userinfo, function (resp) {
                                $.toast(resp.msg, function () {
                                })
                            });
                        } else {
                            AJAX.POST_JSON("wxUser", this.userinfo, function (resp) {
                                that.userinfo = resp.data;
                                $.toast(resp.msg, function () {
                                })

                            });
                        }
                    }
                },
                getQueryString(name) {
                    let reg = new RegExp('(^|&)' + name + '=([^&]*)(&|$)', 'i');
                    let r = window.location.search.substr(1).match(reg);
                    if (r != null) {
                        return unescape(r[2]);
                    }
                    return null;
                },
                initUserInfo() {
                    let that = this;
                    if (this.getQueryString("code") || true) {
                        $.ajax({
                            url: '/viewer/getUserInfo?code=' + this.getQueryString("code"),
                            type: 'GET',
                            async: false,
                            success: function (resp) {
                                if (resp.data) {
                                    that.isComplete = true;
                                    let user = resp.data;
                                    that.userinfo.id = user.id;
                                    that.userinfo.openid = user.openid;
                                    that.userinfo.username = user.username;
                                    that.userinfo.idNum = user.idNum;
                                    that.userinfo.school = user.school;
                                    that.userinfo.phone = user.phone;
                                    that.userinfo.email = user.email;
                                    that.userinfo.sex = user.sex;
                                    if (that.userinfo.id) {
                                        that.isEdit = true;
                                    }
                                }
                                if (!that.userinfo.openid) {
                                }
                            },
                            error: function (err) {
                            }
                        });
                    } else {
                        $.toast("未获取到用户信息", "cancel", function (toast) {
                        });
                    }
                }
            }
        }
    );
</script>
</html>